<div id='map'></div>



<style>

 #map{

  height: 500px;

 }

</style>



<script>

 let map;

 let marker = []; // マーカーを複数表示させたいので、配列化

 let infoWindow = []; // 吹き出しを複数表示させたいので、配列化

 const items = gon.items; // コントローラーで定義したインスタンス変数を変数に代入



 function initMap(){

  // 現在位置の特定

  navigator.geolocation.getCurrentPosition(function (position){

   // LatLngに位置座標を代入

   LatLng = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);



   // mapの初期位置設定

   map = new google.maps.Map(document.getElementById('map'), {

    center: LatLng,

    zoom: 12

   });

  



   // forは繰り返し処理

   // 変数iを0と定義し、

   // その後gonで定義したitems分繰り返し加える処理を行う

   for (let i = 0; i < items.length; i++){

    // items[i]は変数iのユーザーを取得している

    marker[i] = new google.maps.Marker({

     map: map,

     position: {

      // DBに保存してある、緯度・経度を呼び出す

      lat: items[i].latitude,

      lng: items[i].longitude

     }

    });



    // 変数iを変数idに代入

    let id = items[i]['id']



    // infoWindowは吹き出し

    infoWindow[i] = new google.maps.InfoWindow({

     // contentで中身を指定

     // 今回は文字にリンクを貼り付けた形で表示

     content: `<a href='/items/${id}'>${items[i].shopname}</a>`

    });

    // markerがクリックされた時、

    marker[i].addListener("click", function(){

     // infoWindowを表示

     infoWindow[i].open(map, marker[i]);

    });

   }

  });

 }

</script>



<script async defer

   src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API'] %>&callback=initMap">

</script>

